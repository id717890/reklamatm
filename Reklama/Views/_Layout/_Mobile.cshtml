
@{
    Layout = null;
}

<!DOCTYPE html>

<html class=" bg-silver">
<head>
    <meta name="viewport" content="width=device-width" />
    @Styles.Render("~/bundles/styles/bootstrap")
    @Styles.Render("~/bundles/styles/fontawesome")
    @Styles.Render("~/bundles/styles/main-mobile")
    <!-- Scrollbar Custom CSS -->
    @*<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">*@
    @RenderSection("Styles", required: false)

    @*@Styles.Render("~/Scripts/fancybox/jquery.fancybox.css")*@
    @*@Styles.Render("~/Content/buttons.css")*@
    @*@Styles.Render("~/Content/css")*@
    @*@Scripts.Render("~/bundles/modernizr")*@
    @*@Styles.Render("~/Scripts/tinymce/skins/lightgray/skin.min.css")*@
    @*<link href="@Url.Content("~/Content/Reset.css")" rel="stylesheet" />*@
    

    <title>www.reklama.tm</title>
</head>
<body>
    <div class="container-fluid p-0 h-100 bg-silver">
        <div class="row bg-silver p-0 m-0 h-100">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-5 col-xl-4" style="margin: 0 auto">
                <!-- Sidebar  -->
                <nav id="sidebar">
                    <div id="dismiss">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <div class="sidebar-header text-center">
                        <img style="width: 60px;" src="/Images/System/logo1.png">
                    </div>

                    <ul class="list-unstyled components" style="border-bottom: none">
                        @*<li>
                            <div class="input-group ml-4 mr-4 mb-3 w-auto">
                                <input type="text" class="form-control" placeholder="Поиск">
                                <div class="input-group-append">
                                    <button class="btn btn-success" type="button" id="button-addon2"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        </li>*@
                        <li class="@(ViewContext.RouteData.Values["Action"].ToString().ToLower() == "indexmobile" || ViewContext.RouteData.Values["Action"].ToString().ToLower() == "index" ? "active" : "")">
                            <a href="@Url.Action("IndexMobile", "Home")"><i class="fa fa-home"></i> Главная</a>
                        </li>
                        <li>
                            <a href="@Url.Action("LoginMobile","Account")"><i class="fa fa-tv"></i> Личный кабинет</a>
                        </li>
                        <li class="@(ViewContext.RouteData.Values["Action"].ToString().ToLower() == "filtersmobile" ? "active" : "")">
                            <a href="@Url.Action("FiltersMobile","Home")"><i class="fa fa-filter"></i> Фильтры</a>
                        </li>
                        <li>
                            <a href="/Page/Details/2"><i class="fa fa-toolbox"></i> Соглашение</a>
                        </li>
                        <li>
                            <ul class="list-unstyled CTAs">
                                <li>
                                    <a href="/Realty/CreateMobile" class="download" style="color: #7386D5 !important">
                                        Разместить объявление
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="active text-center static">
                            <a style="background: #5362a5"><i class="fa fa-envelope"></i> Reklama.tm@mail.ru</a>
                        </li>
                    </ul>

                </nav>
                <button type="button" id="sidebarCollapse" class="btn btn-default position-absolute" style="left: 10px; top: 4px; color: silver">
                    <i class="fas fa-align-left fa-2x"></i>
                </button>
                @RenderBody()
            </div>
        </div>
    </div>

    <!-- load jQuery 3.0.0 -->
    @*<script type="text/javascript" src="~/Scripts/jquery-3.0.0.min.js"></script>
        <script type="text/javascript">
            var $ = $.noConflict(true);
        </script>*@

    <!-- 1. Add latest jQuery and fancybox files -->

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    @*<script type="text/javascript">
            var $ = $.noConflict(true);
        </script>*@




    @Scripts.Render("~/bundles/js/bootstrap")



    @*@Scripts.Render("~/Scripts/jquery.mCustomScrollbar.js")*@
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>*@

    @*<script src="https://code.jquery.com/jquery-1.12.4.js"></script>*@
    @*<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>*@
    @Scripts.Render("~/Scripts/jquery-ui-1.12.1.min.js")
    <script type="text/javascript">
        $(document).ready(function () {
            //jQuery_1_10_2("#sidebar").mCustomScrollbar({
            //    theme: "minimal"
            //});

            //$('.car-img').each(function () {
            //    //var id = $(this).data('car-img-id');
            //    console.log($(this).height())
            //    if ($(this).height() < 230) {
            //        //$('#car-img-' + id).css({height: '100% !important'})
            //        $(this).css({ height: '100%' });
            //    }
            //});

            //function setHeight(id) {
            //    $('*[data-car-img-id="' + id +'"]').each(function () {
            //        //var id = $(this).data('car-img-id');
            //        console.log($(this).height())
            //        if ($(this).height() < 230) {
            //            //$('#car-img-' + id).css({height: '100% !important'})
            //            $(this).css({ height: '100%' });
            //        }
            //    });
            //}


            $('#dismiss, .overlay').on('click', function () {
                $('#sidebar').removeClass('active');
                $('.overlay').removeClass('active');
            });

            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').addClass('active');
                $('.overlay').addClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });

            $(".item-short").on("click", function () {
                var id = $(this).data("id");
                $("#item-details" + id).show("blind", "fast", function () {
                    $("#item" + id).hide("blind", "fast");
                    $(this).css("display", "flex");
                    //setHeight(id);
                });
                //Увеличение кол-ва просмотров при клике и разворачивании объявления
                $.ajax({
                    url: '/Realty/IncreaseViews',
                    type: 'POST',
                    data: { id: id}
                });
            });

            $(".item-details-btn").on("click", function () {
                var id = $(this).data("id");
                if (!$(this).hasClass('phone-field')) {
                    $("#item" + id).show("blind", "fast", function () {
                        $("#item-details" + id).hide("blind", "fast");
                    });
                }
                
            });

            $(".btn-field-sort").click(function () {
                var count = $(this).data("sort");
                $('#field-sort-field').val(count);
                $(".btn-field-sort").removeClass("active btn-primary");
                $(this).addClass("active btn-primary");
            });

            $(".btn-direction-sort").click(function () {
                var count = $(this).data("sort");
                $('#direction-sort-field').val(count);
                $(".btn-direction-sort").removeClass("active btn-primary");
                $(this).addClass("active btn-primary");
            });

            $(".btn-room-count").click(function () {
                var count = $(this).data("count");
                $('#room-count-field').val(count);
                $(".btn-room-count").removeClass("active btn-primary");
                $(this).addClass("active btn-primary");
            });

            $(".btn-room-count-multy").click(function () {
                $(this).toggleClass("active btn-primary");
                var str = '';
                $(".btn-room-count-multy.active").each(function (x, y) {
                    str += $(this).data("count") + "|";
                });
                $('#room-count-field-multy').val(str);
            });

            //$('.carousel-item-details').find('img').each(function () {
            //    var imgClass = (this.width / this.height > 1) ? 'wide' : 'tall';
            //    $(this).addClass(imgClass);
            //});
        });
    </script>


    <!-- /Yandex.Metrika counter -->
    @*@Scripts.Render("~/Scripts/common.js")*@
    @*@Scripts.Render("~/Scripts/jquery.textshadow.js")*@
    @*@Scripts.Render("~/Scripts/jquery.equal-height-columns.js")*@
    @*@Scripts.Render("~/Scripts/photo/jquery.mousewheel.js")*@
    @*@Scripts.Render("~/Scripts/jquery.fancybox.js")*@
    @*@Scripts.Render("~/Scripts/reactive.js")*@
    @*@Scripts.Render("/Scripts/slides.min.jquery.js")*@
    @*Scripts.Render("~/bundles/angular-file-uploader")*@
    @*@Scripts.Render("~/Scripts/angular/es5-shim.min.js")*@
    @Scripts.Render("~/Scripts/angular/angular.min.js")
    @Scripts.Render("~/Scripts/angular/angular-file-upload.js")
    @Scripts.Render("~/Scripts/angular/controllers.js")
    @Scripts.Render("~/Scripts/angular/directives.js")
    @*@Scripts.Render("~/Scripts/Search.js")*@
    @*<script src="@Url.Content("~/Scripts/regionSections.js")" type="text/javascript"></script>*@

    @RenderSection("Scripts", required: false)

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
    <script>
        function removeImage(fileName, pos) {
            console.log(fileName)
            console.log(pos)
            var selector = ".uploadedImage[data-filename='" + fileName + "']";
            var selector2 = "#image_" + pos;
            var file = $(selector);
            var element = $(selector2);
            console.log(file);
            console.log(element);

            if (file) {
                remove(file.val());
                file.remove();
                element.remove();
            }
            return false;
        }

        function rndString() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        const vueApp = new Vue({
            el: '#vueuploader',
            data: {
                ctor: null,
                files: null,
                html: '',
                progress: []
            },
            methods: {
                onFileSelected(ctor, event) {
                    this.ctor = ctor
                    this.files = event.target.files
                    //this.html = ''
                    this.onUpload()
                },
                callbackClosure(i, callback) {
                    return function () {
                        return callback(i)
                    }
                },
                onUpload() {
                    if (this.files) {
                        for (var i = 0; i <= this.files.length - 1; i++) {
                            const rndStr = rndString();
                            $('#imgcontainer').append(`
                                <div class="col-lg-4 col-md-6 col-6 px-0 thumb img-block-gallery" data-filename="image_` + rndStr + `" id="image_` + rndStr + `">
                                <div id="progress_`+ rndStr + `">
                                    <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
                                </div>
                                </div>`)
                            const fd = new FormData()
                            fd.append('file', this.files[i], this.files[i].name)
                            fd.append('cController', this.ctor)
                            fd.append('pos', i)
                            fd.append('rndStr', rndStr)
                            axios.post('/AjaxServices/angularUploadFile', fd, {
                                onUploadProgress: uploadEvent => {
                                    console.log('progress: ' + uploadEvent.loaded / uploadEvent.total * 100)
                                }
                            }).then(x => {
                                //console.log(x)
                                $('#progress_' + x.data.rndStr).remove();
                                $('#imageContainer').append('<input type="hidden" name="imagesNames[]" class="uploadedImage" data-filename="' + x.data.filename + '" value="' + x.data.newFilename + '" />');
                                $('#image_' + x.data.rndStr).append(`
                                    <a href="#" class="button remove remove-times" title="" data-filename="` + x.data.filename + `" onclick="javascript: removeImage('` + x.data.filename + `', '` + x.data.rndStr +`'); return false;"ng-click="item.remove()">
                                        <i class="fa fa-times fa-2x text-danger"></i>
                                    </a>
                                    <a  style="float: right; width: 100%;" href="#" onclick="event.preventDefault()">
                                        <img class="img-fluid" style="width: 100%" src="/Images/Thumbnails/Realty/`+ x.data.newFilename + `">
                                    </a>`)
                                //console.log(this.$refs['progress_' + x.data.pos])
                                //this.$refs['progress_' + x.data.pos].remove()
                                //console.log(x)
                            })
                        }
                    }
                }
            }
        })
    </script>


</body>
</html>
